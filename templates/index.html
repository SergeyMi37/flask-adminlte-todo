{% extends "base.html" %}

{% block title %}{{ _('Dashboard') }} - {{ _('Todo App') }}{% endblock %}
{% block meta_title %}{{ _('Dashboard') }} - {{ _('Todo App') }}{% endblock %}
{% block meta_description %}Dashboard view of your Todo application{% endblock %}

{% block page_title %}Dashboard{% endblock %}
{% block breadcrumb %}{{ _('Dashboard') }}{% endblock %}

{% block content %}
<!--begin::Row-->
<div class="row">
  <!--begin::Col-->
  <div class="col-lg-3 col-6">
    <!--begin::Small Box Widget 1-->
    <div class="small-box text-bg-primary">
      <div class="inner">
        <h3>{{ todos|length }}</h3>
        <p>{{ _('Total Todos') }}</p>
      </div>
      <svg
        class="small-box-icon"
        fill="currentColor"
        viewBox="0 0 24 24"
        xmlns="http://www.w3.org/2000/svg"
        aria-hidden="true"
      >
        <path
          d="M2.25 2.25a.75.75 0 000 1.5h1.386c.17 0 .318.114.362.278l2.558 9.592a3.752 3.752 0 00-2.806 3.63c0 .414.336.75.75.75h15.75a.75.75 0 000-1.5H5.378A2.25 2.25 0 017.5 15h11.218a.75.75 0 00.674-.421 60.358 60.358 0 002.96-7.228.75.75 0 00-.525-.965A60.864 60.864 0 005.68 4.509l-.232-.867A1.875 1.875 0 003.636 2.25H2.25zM3.75 20.25a1.5 1.5 0 113 0 1.5 1.5 0 01-3 0zM16.5 20.25a1.5 1.5 0 113 0 1.5 1.5 0 01-3 0z"
        ></path>
      </svg>
      <a
        href="{{ url_for('index') }}"
        class="small-box-footer link-light link-underline-opacity-0 link-underline-opacity-50-hover"
      >
        More info <i class="bi bi-link-45deg"></i>
      </a>
    </div>
    <!--end::Small Box Widget 1-->
  </div>
  <!--end::Col-->
  <div class="col-lg-3 col-6">
    <!--begin::Small Box Widget 2-->
    <div class="small-box text-bg-success">
      <div class="inner">
        <h3>{{ todos|selectattr('completed', 'equalto', True)|list|length }}</h3>
        <p>{{ _('Completed Todos') }}</p>
      </div>
      <svg
        class="small-box-icon"
        fill="currentColor"
        viewBox="0 0 24 24"
        xmlns="http://www.w3.org/2000/svg"
        aria-hidden="true"
      >
        <path
          d="M18.375 2.25c-1.035 0-1.875.84-1.875 1.875v15.75c0 1.035.84 1.875 1.875 1.875h.75c1.035 0 1.875-.84 1.875-1.875V4.125c0-1.036-.84-1.875-1.875-1.875h-.75zM9.75 8.625c0-1.036.84-1.875 1.875-1.875h.75c1.036 0 1.875.84 1.875 1.875v11.25c0 1.035-.84 1.875-1.875 1.875h-.75a1.875 1.875 0 01-1.875-1.875V8.625zM3 13.125c0-1.036.84-1.875 1.875-1.875h.75c1.036 0 1.875.84 1.875 1.875v6.75c0 1.035-.84 1.875-1.875 1.875h-.75A1.875 1.875 0 013 19.875v-6.75z"
        ></path>
      </svg>
      <a
        href="{{ url_for('index') }}"
        class="small-box-footer link-light link-underline-opacity-0 link-underline-opacity-50-hover"
      >
        More info <i class="bi bi-link-45deg"></i>
      </a>
    </div>
    <!--end::Small Box Widget 2-->
  </div>
  <!--end::Col-->
  <div class="col-lg-3 col-6">
    <!--begin::Small Box Widget 3-->
    <div class="small-box text-bg-warning">
      <div class="inner">
        <h3>{{ todos|selectattr('completed', 'equalto', False)|list|length }}</h3>
        <p>{{ _('Pending Todos') }}</p>
      </div>
      <svg
        class="small-box-icon"
        fill="currentColor"
        viewBox="0 0 24 24"
        xmlns="http://www.w3.org/2000/svg"
        aria-hidden="true"
      >
        <path
          d="M6.25 6.375a4.125 4.125 0 118.25 0 4.125 4.125 0 01-8.25 0zM3.25 19.125a7.125 7.125 0 0114.25 0v.003l-.001.119a.75.75 0 01-.363.63 13.067 13.067 0 01-6.761 1.873c-2.472 0-4.786-.684-6.76-1.873a.75.75 0 01-.364-.63l-.001-.122zM19.75 7.5a.75.75 0 00-1.5 0v2.25H16a.75.75 0 000 1.5h2.25v2.25a.75.75 0 001.5 0v-2.25H22a.75.75 0 000-1.5h-2.25V7.5z"
        ></path>
      </svg>
      <a
        href="{{ url_for('index') }}"
        class="small-box-footer link-dark link-underline-opacity-0 link-underline-opacity-50-hover"
      >
        More info <i class="bi bi-link-45deg"></i>
      </a>
    </div>
    <!--end::Small Box Widget 3-->
  </div>
  <!--end::Col-->
  <div class="col-lg-3 col-6">
    <!--begin::Small Box Widget 4-->
    <div class="small-box text-bg-danger">
      <div class="inner">
        <h3>{{ (todos|selectattr('completed', 'equalto', True)|list|length / todos|length * 100)|round|int if todos else 0 }}<sup class="fs-5">%</sup></h3>
        <p>{{ _('Completion Rate') }}</p>
      </div>
      <svg
        class="small-box-icon"
        fill="currentColor"
        viewBox="0 0 24 24"
        xmlns="http://www.w3.org/2000/svg"
        aria-hidden="true"
      >
        <path
          clip-rule="evenodd"
          fill-rule="evenodd"
          d="M2.25 13.5a8.25 8.25 0 018.25-8.25.75.75 0 01.75.75v6.75H18a.75.75 0 01.75.75 8.25 8.25 0 01-16.5 0z"
        ></path>
        <path
          clip-rule="evenodd"
          fill-rule="evenodd"
          d="M12.75 3a.75.75 0 01.75-.75 8.25 8.25 0 018.25 8.25.75.75 0 01-.75.75h-7.5a.75.75 0 01-.75-.75V3z"
        ></path>
      </svg>
      <a
        href="{{ url_for('index') }}"
        class="small-box-footer link-light link-underline-opacity-0 link-underline-opacity-50-hover"
      >
        More info <i class="bi bi-link-45deg"></i>
      </a>
    </div>
    <!--end::Small Box Widget 4-->
  </div>
  <!--end::Col-->
</div>
<!--end::Row-->

<!--begin::Row-->
<div class="row">
  <div class="col-12">
    <div class="card">
      <div class="card-header">
        <h3 class="card-title">{{ _('All Todos') }}</h3>
        <div class="card-tools">
          <a href="{{ url_for('new_todo') }}" class="btn btn-primary btn-sm">
            <i class="bi bi-plus-circle"></i> {{ _('Add Todo') }}
          </a>
        </div>
      </div>

      <!-- Controls for pagination -->
      <div class="card-header">
        <div class="row align-items-center">
          <div class="col-sm-6">
            <div class="d-flex align-items-center">
              <label for="per_page" class="me-2">{{ _('Show') }}:</label>
              <select id="per_page" class="form-select form-select-sm" style="width: auto;" onchange="changePerPage(this.value)">
                <option value="5"{% if per_page == 5 %} selected{% endif %}>5</option>
                <option value="10"{% if per_page == 10 %} selected{% endif %}>10</option>
                <option value="25"{% if per_page == 25 %} selected{% endif %}>25</option>
                <option value="50"{% if per_page == 50 %} selected{% endif %}>50</option>
                <option value="100"{% if per_page == 100 %} selected{% endif %}>100</option>
              </select>
              <span class="ms-2">{{ _('entries') }}</span>
            </div>
          </div>
          <div class="col-sm-6">
            <div class="d-flex justify-content-end">
              <small class="text-muted">
                {% set start = pagination.page * pagination.per_page - pagination.per_page + 1 %}
                {% set end = (pagination.page * pagination.per_page) if (pagination.page * pagination.per_page) < pagination.total else pagination.total %}
                {{ _('Showing') }} {{ start }} {{ _('to') }} {{ end }} {{ _('of') }}
                {{ pagination.total }} {{ _('entries') }}
              </small>
            </div>
          </div>
        </div>
      </div>

      <div class="card-body table-responsive p-0">
        <table class="table table-hover text-nowrap">
          <thead>
            <tr>
              <th>ID</th>
              <th>{{ _('Title') }}</th>
              <th>{{ _('Description') }}</th>
              <th>{{ _('Status') }}</th>
              <th>{{ _('Due Date') }}</th>
              <th>{{ _('Created') }}</th>
              <th>{{ _('Actions') }}</th>
            </tr>
          </thead>
          <tbody>
            {% for todo in todos %}
            <tr>
              <td>{{ todo.id }}</td>
              <td>{{ todo.title }}</td>
              <td>{{ todo.description or '-' }}</td>
              <td>
                {% if todo.completed %}
                  <span class="badge text-bg-success">{{ _('Completed') }}</span>
                {% else %}
                  <span class="badge text-bg-warning">{{ _('Pending') }}</span>
                {% endif %}
              </td>
              <td>{{ todo.due_date.strftime('%Y-%m-%d') if todo.due_date else '-' }}</td>
              <td>{{ todo.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
              <td>
                <div class="btn-group">
                  <a href="{{ url_for('edit_todo', id=todo.id) }}" class="btn btn-sm btn-outline-primary">
                    <i class="bi bi-pencil"></i>
                  </a>
                  <a href="{{ url_for('delete_todo', id=todo.id) }}" class="btn btn-sm btn-outline-danger"
                     data-confirm="{{ _('Are you sure you want to delete this todo?') }}" onclick="return confirm(this.getAttribute('data-confirm'))">
                    <i class="bi bi-trash"></i>
                  </a>
                  <a href="{{ url_for('toggle_todo', id=todo.id) }}" class="btn btn-sm btn-outline-secondary">
                    <i class="bi bi-check-circle{% if todo.completed %}-fill{% endif %}"></i>
                  </a>
                </div>
              </td>
            </tr>
            {% endfor %}
            {% if not todos %}
            <tr>
              <td colspan="7" class="text-center text-muted">
                {{ _('No todos found. ') }}<a href="{{ url_for('new_todo') }}">{{ _('Create your first todo') }}</a>.
              </td>
            </tr>
            {% endif %}
          </tbody>
        </table>
      </div>

      <!-- Pagination -->
      {% if pagination.pages > 1 %}
      <div class="card-footer">
        <nav aria-label="Page navigation">
          <ul class="pagination pagination-sm justify-content-center mb-0">
            {% if pagination.has_prev %}
            <li class="page-item">
              <a class="page-link" href="{{ url_for('index', page=pagination.prev_num, per_page=per_page) }}" aria-label="Previous">
                <span aria-hidden="true">&laquo;</span>
              </a>
            </li>
            {% else %}
            <li class="page-item disabled">
              <span class="page-link">&laquo;</span>
            </li>
            {% endif %}

            {% for page_num in pagination.iter_pages() %}
              {% if page_num %}
                {% if page_num == pagination.page %}
                <li class="page-item active">
                  <span class="page-link">{{ page_num }}</span>
                </li>
                {% else %}
                <li class="page-item">
                  <a class="page-link" href="{{ url_for('index', page=page_num, per_page=per_page) }}">{{ page_num }}</a>
                </li>
                {% endif %}
              {% else %}
                <li class="page-item disabled">
                  <span class="page-link">...</span>
                </li>
              {% endif %}
            {% endfor %}

            {% if pagination.has_next %}
            <li class="page-item">
              <a class="page-link" href="{{ url_for('index', page=pagination.next_num, per_page=per_page) }}" aria-label="Next">
                <span aria-hidden="true">&raquo;</span>
              </a>
            </li>
            {% else %}
            <li class="page-item disabled">
              <span class="page-link">&raquo;</span>
            </li>
            {% endif %}
          </ul>
        </nav>
      </div>
      {% endif %}
    </div>
  </div>
</div>
<!--end::Row-->
{% endblock %}